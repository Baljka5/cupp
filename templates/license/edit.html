{% extends "base.html" %}
{% load widget_tweaks %}
{% load event_tags %}

{% block header %}
{% endblock %}
{% block content %}
    <div class="col-md-12">
        <form method="POST" class="post-form" action="{% url 'lic-update' model.id %}">
            {% csrf_token %}
            {{ form.as_p }}
            {% if dispute_form.errors %}
                <div class="alert alert-danger">
                    <ul>
                        {% for field, errors in dispute_form.errors.items %}
                            <li>{{ field }}: {{ errors|join:", " }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <div class="container">
                {% if user.is_authenticated %}
                    {% is_in_license_group as user_in_license_group %}
                    {% if user_in_license_group %}
                        <div class="col-12">
                            <h3>Update Details</h3>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Дугаар: </label>
                            <input type="text" class="form-control" name="id" id="id_id" readonly
                                   value="{{ model.id }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Store code: </label>
                            <input type="number" class="form-control" name="store_id" id="id_store_code"
                                   value="{{ model.store_id }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лицензийн төрөл:</label>
                            <select name="lic_id" id="id_lic_id" class="form-control">
                                {% for type in types %}
                                    <option value="{{ type.lic_id }}"
                                            {% if type.lic_id == model.lic_id.lic_id %}selected{% endif %}>
                                        {{ type.lic_id }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лицензийн төрлийн нэр:</label>
                            <select name="lic_id_nm" id="id_lic_id_nm" class="form-control">
                                {% for type in types %}
                                    <option value="{{ type.lic_id_nm }}"
                                            {% if type.lic_id_nm == model.lic_id_nm %}selected{% endif %}>
                                        {{ type.lic_id_nm }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лицензтэй эсэх: </label>
                            <select class="form-control" name="lic_yn" id="id_lic_yn">
                                <option value="True" {% if model.lic_yn %}selected{% endif %}>Тийм</option>
                                <option value="False" {% if not model.lic_yn %}selected{% endif %}>Үгүй</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз авсан огноо: </label>
                            <input type="date" class="form-control" name="st_dt" id="id_st_dt"
                                   value="{{ model.st_dt|date:"Y-m-d" }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз дуусах огноо: </label>
                            <input type="date" class="form-control" name="ed_dt" id="id_ed_dt"
                                   value="{{ model.ed_dt|date:"Y-m-d" }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз авсан ажилтан:</label>
                            <input type="text" class="form-control" name="lic_owner" id="id_lic_owner"
                                   maxlength="255" value="{{ model.lic_owner }}"/>
                        </div>
                        <div class="form-group col-md-6 liquor-time">
                            <label>Архи зарж эхлэх цаг: </label>
                            <input type="time" id="id_alc_opentime" name="alc_opentime" class="form-control"
                                   value="{{ model.alc_opentime|time:'H:i' }}">
                        </div>
                        <div class="form-group col-md-6 liquor-time">
                            <label>Архи зарж дуусах цаг:</label>
                            <input type="time" id="id_alc_closetime" name="alc_closetime" class="form-control"
                                   value="{{ model.alc_closetime|time:'H:i' }}">
                        </div>
                        <div class="form-group col-md-6 camera-count">
                            <label>Камерын тоо:</label>
                            <input type="number" id="id_camera_cnt" name="camera_cnt" class="form-control"
                                   value="{{ model.camera_cnt }}">
                        </div>
                        <div class="form-group col-md-6 field-size">
                            <label>Талбайн хэмжээ:</label>
                            <input type="number" id="id_lic_sqrm" name="lic_sqrm" class="form-control"
                                   value="{{ model.lic_sqrm }}">
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз олгосон газрын нэр ID:</label>
                            <input type="text" class="form-control" name="lic_prov_ID" id="id_lic_prov_ID"
                                   maxlength="255" value="{{ model.lic_prov_ID }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз олгосон газар:</label>
                            <input type="text" class="form-control" name="lic_prov_name" id="id_lic_prov_name"
                                   maxlength="255" value="{{ model.lic_prov_name }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лицензийн код:</label>
                            <input type="text" class="form-control" name="lic_no" id="id_lic_no"
                                   maxlength="255" value="{{ model.lic_no }}"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Архины төрөл:</label>
                            <select name="alc_type" id="id_alc_type" class="form-control">
                                <option value="">--------</option>
                                <option value="high" {% if model.alc_type == "high" %}selected{% endif %}>High</option>
                                <option value="low" {% if model.alc_type == "low" %}selected{% endif %}>Low</option>
                                <option value="both" {% if model.alc_type == "both" %}selected{% endif %}>Both</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Зөвшөөрлийн төрөл:</label>
                            <select name="lic_type" id="id_lic_type" class="form-control">
                                <option value="">--------</option>
                                <option value="24H" {% if model.lic_type == "24H" %}selected{% endif %}>24H</option>
                                <option value="17H" {% if model.lic_type == "17H" %}selected{% endif %}>17H</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Зөвшөөрөл байршиж буй холбоос /sharepoint холбоос/:</label>
                            <input type="url" class="form-control" name="link_path" id="id_link_path"
                                   value="{{ model.link_path }}">
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лиценз авсан /Хот, Дүүрэг, Аймаг/:</label>
                            <select name="district" id="id_district" class="form-control">
                                {% for district in districts %}
                                    <option value="{{ district.id }}"
                                            {% if model.district and model.district.id == district.id %}selected{% endif %}>
                                        {{ district.district_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Лицензын төлөв:</label>
                            <select name="lic_status" id="id_lic_status" class="form-control">
                                <option value="">--------</option>
                                <option value="True" {% if model.lic_status %}selected{% endif %}>Active</option>
                                <option value="False" {% if not model.lic_status %}selected{% endif %}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Зөвшөөрлийн нийт хугацаа:</label>
                            <input type="number" class="form-control" name="lic_duration" id="id_lic_duration"
                                   value="{{ model.lic_duration }}">
                        </div>
                        <div class="form-group col-md-6">
                            <a href="{% url 'index' %}" class="btn btn-link text-purple-300">
                                Cancel
                            </a>
                        </div>
                        div class="form-group col-md-6">
                        <button type="submit" name="license_update" class="btn btn-success btn-lg">Update License
                        </button>
                        </div>
                    {% endif %}
                {% endif %}
        </form>
    </div>
    <!-- Dispute Fields for Legal Team -->
    <form method="POST" class="post-form" action="{% url 'lic-update' model.id %}">
        {% csrf_token %}
        <div class="container">
            {% if user.is_authenticated %}
                {% is_in_legal_team_group as user_in_legal_team_group %}
                {% if user_in_legal_team_group %}
                    <h3>Dispute Information</h3>
                    <div class="form-group col-md-6">
                        <label>Дугаар: </label>
                        <input type="text" class="form-control" name="id" id="id_id" required readonly
                               value="{{ dispute_table.id }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Бодит үйл явдал болсон огноо:</label>
                        <input type="date" class="form-control" name="date" id="id_date"
                               value="{{ dispute_table.date|date:"Y-m-d" }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Дэлгүүрийн дугаар: <span class="text-purple">*</span></label>
                        <select id="id_store_no" class="form-control" name="store_no">
                            {% for store_id, store_name in store_id_to_name.items %}
                                <option value="{{ store_id }}" data-name="{{ store_name }}"
                                        {% if dispute_table.store_no == store_id %}selected{% endif %}>
                                    {{ store_id }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Дэлгүүрийн нэр: <span class="text-purple">*</span></label>
                        <input id="id_store_name" value="{{ dispute_table.store_name }}" class="form-control"
                               name="store_name"
                               readonly type="text">
                    </div>
                    <div class="form-group col-md-6">
                        <label>Болсон хэргийн талаар дэлгэрэнгүй мэдээлэл: </label>
                        <input type="text" class="form-control" name="disp_desc" id="id_disp_desc" required
                               value="{{ dispute_table.disp_desc }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хэргийн төрөл: <span class="text-purple">*</span></label>
                        <select name="disp_cat" id="id_disp_cat" class="form-control" required>
                            <option value="">{{ dispuete_form.disp_cat.value|default_if_none:"Choose an option" }}</option>
                            <option value="ТАНХАЙ"
                                    {% if dispute_table.disp_cat == "ТАНХАЙ" %}selected{% endif %}>
                                ТАНХАЙ
                            </option>
                            <option value="ДЭЭРЭМ"
                                    {% if dispute_table.disp_cat == "ДЭЭРЭМ" %}selected{% endif %}>
                                ДЭЭРЭМ
                            </option>
                            <option value="ХУЛГАЙ"
                                    {% if dispute_table.disp_cat == "ХУЛГАЙ" %}selected{% endif %}>
                                ХУЛГАЙ
                            </option>
                            <option value="ЗӨРЧИЛ"
                                    {% if dispute_table.disp_cat == "ЗӨРЧИЛ" %}selected{% endif %}>
                                ЗӨРЧИЛ
                            </option>
                            <option value="БУСАД" {% if dispute_table.disp_cat == "БУСАД" %}selected{% endif %}>
                                БУСАД
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хохирлын хэмжээ/ мөнгөн дүн: </label>
                        <input type="number" class="form-control" name="dmg_amt" id="id_dmg_amt" required
                               value="{{ dispute_table.dmg_amt }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хохирлын хэмжигдэхүүн: </label>
                        <input type="text" class="form-control" name="dmg_uom" id="id_dmg_uom" required
                               value="{{ dispute_table.dmg_uom }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хариуцагч: </label>
                        <select name="disp_owner" id="id_disp_owner" class="form-control">
                            {% for owner in owners %}
                                <option value="{{ owner.own_id }}"
                                        {% if dispute_table and dispute_table.disp_owner.id == owner.id %}selected{% endif %}>
                                    {{ owner.own_pos }} - {{ owner.own_dep }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group col-md-6">
                        <label>Хэргийн төлөв: <span class="text-purple">*</span></label>
                        <select name="disp_status" id="id_disp_status" class="form-control" required>
                            <option value="">{{ disp_status }}</option>
                            <option value="False" {% if dispute_table.disp_status %}selected{% endif %}>Нээлттэй
                            </option>
                            <option value="True" {% if dispute_table.disp_status == False %}selected{% endif %}>
                                Хаагдсан
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хэргийн явц: </label>
                        <input type="text" class="form-control" name="disp_progress" id="id_disp_progress"
                               required
                               value="{{ dispute_table.disp_progress }}"/>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хэрэг шийдэгдсэн эсэх: <span class="text-purple">*</span></label>
                        <select name="disp_result" id="id_disp_result" class="form-control" required>
                            <option value="">{{ dispute_table.disp_result }}</option>
                            <option value="True" {% if dispute_table.disp_result %}selected{% endif %}>Тийм
                            </option>
                            <option value="False"
                                    {% if dispute_table.disp_result == False %}selected{% endif %}>
                                Үгүй
                            </option>
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label>Хэрэг шийдэгдсэн өдөр:</label>
                        <input type="url" class="form-control" name="link_path" id="id_link_path"
                               value="{{ dispute_form.link_path.value|default_if_none:'' }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label>Холбогдох баримт бичгийн холбоос:</label>
                        <input type="url" class="form-control" name="supp_link" id="id_supp_link"
                               value="{{ dispute_table.supp_link }}">
                    </div>
                    <div class="form-group col-md-6">
                        <a href="{% url 'index' %}" class="btn btn-link text-purple-300">
                            Cancel
                        </a>
                    </div>
                    <div class="form-group col-md-6">
                        <button type="submit" name="dispute_update" class="btn btn-success btn-lg">Update Dispute
                        </button>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </form>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.13.18/jquery.timepicker.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.13.18/jquery.timepicker.min.css"/>
    <script>
        $(document).ready(function () {
            $('#id_store_no').select2({
                width: '100%',
                placeholder: "Select a Store ID",
            });

            $('#id_store_no').change(function () {
                var selectedName = $(this).find('option:selected').attr('data-name');
                $('#id_store_name').val(selectedName);
                $('#id_store_name').prop('readonly', true);
            });


            $('#id_date').daterangepicker({
                singleDatePicker: true,
                applyClass: 'bg-purple btn-sm',
                cancelClass: 'btn-light btn-sm',
                locale: {
                    format: 'YYYY/MM/DD'
                }
            });
        });
    </script>
    </form>
{% endblock content %}
