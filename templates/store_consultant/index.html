{% extends "base.html" %}
{% load event_tags %}
{% load widget_tweaks %}

{% block header %}
    <!-- You can add specific header content here if needed, such as a page title -->
{% endblock %}

{% block content %}
    <div class="content">
        <div class="teams-container">
            <div class="team-row">
                {% for area in areas %}
                    <div class="team">
                        <div class="team-header">{{ area.team_no }}</div>
                        <!-- Make team-body a drop zone -->
                        <div class="team-body" ondrop="drop(event)" ondragover="allowDrop(event)"
                             data-area-id="{{ area.id }}">
                            <!-- Your code for displaying team consultants goes here -->
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="not-allocated" ondrop="drop(event)" ondragover="allowDrop(event)">
                {% for consultant in consultants %}
                    <!-- Make sc elements draggable -->
                    <div class="sc" id="sc{{ consultant.id }}" draggable="true" ondragstart="drag(event)"
                         data-consultant-id="{{ consultant.id }}">
                        {{ consultant.sc_name }}
                    </div>
                {% endfor %}
            </div>
            <div class="save-close-container">
                <button id="saveCloseBtn">SAVE & CLOSE</button>
            </div>
        </div>
    </div>
    <style>
        .teams-container {
            display: flex;
            flex-direction: column;
            margin: 0 20px;
        }

        .team-row {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .team {
            background-color: #D1D0CF;
            padding: 10px;
            margin-bottom: 20px;
            flex: 1;
            margin-left: 20px;
        }

        .team:first-child {
            margin-left: 0;
        }

        .team-body {
            background-color: #F4E2D0;
            padding: 10px;
            margin: 5px;
        }

        .team-header {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .sc {
            background-color: #ffcc99;
            padding: 5px;
            margin: 5px 5px;

        }

        .not-allocated {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .save-close-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        #saveCloseBtn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

    </style>

    <script>
        function allowDrop(event) {
            event.preventDefault(); // Necessary to allow dropping
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id); // Set the id of the drag source
        }

        function drop(event) {
            event.preventDefault();
            var data = event.dataTransfer.getData("text");
            var consultantId = document.getElementById(data).getAttribute('data-consultant-id');
            var targetAreaId = event.target.getAttribute('data-area-id');
            event.target.appendChild(document.getElementById(data)); // Append the consultant to the new team

            // Now you can make an AJAX call to update the backend
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/your-update-url/', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken')); // Add the CSRF token
            xhr.send('consultantId=' + consultantId + '&targetAreaId=' + targetAreaId);

            // You may want to update your page based on the server's response
            xhr.onload = function () {
                if (xhr.status == 200) {
                    // Handle successful response
                } else {
                    // Handle error response
                }
            };
        }

        // Function to get the value of a cookie by name
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

{% endblock %}
